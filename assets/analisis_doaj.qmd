---
title: "An√°lisis sobre revistas en Am√©rica Latina desde datos obtenidos de DOAJ"
author: "Romina De Le√≥n"
format: 
  html:
    toc: true
    code-fold: true
    embed-resources: true
    theme: cosmo
editor: visual
---

# An√°lisis de datos de DOAJ para Am√©rica Latina

#### Romina De Le√≥n

###### romideleon@gmail.com

```{r setup}
# Configuraci√≥n inicial
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## üîß Carga de paquetes y preparaci√≥n

```{r}
# Instalar solo si hace falta (recomendado: correr antes manualmente)
# packages <- c("tidytext", "gapminder", "tidyverse", "dplyr", "ggplot2", "treemapify", "magrittr", "rio", "xlsx", "stringr", "highcharter", "htmlwidgets", "webshot")

# Cargar librer√≠as
library(tidyverse)
library(dplyr)
library(ggplot2)
library(treemapify)
library(tidytext)
library(gapminder)
library(magrittr)
library(tidyselect)
library(purrr)
library(readr)
library(rio)
library(stringr)
library(highcharter)
library(htmlwidgets)
library(webshot)

```

## üìÇ Cargar base de datos

```{r}

#direccion de imagenes
dir_output <- "plots/visualizaciones/2025"
# Leer CSV local
journal <- read.csv("E:/hd-git/analisis-doaj/assets/datos/2025_journalcsv.csv")
journal <- as_tibble(journal)

```

## üìã Selecci√≥n y transformaci√≥n de variables

```{r}
journal.select <- journal %>%
  select(Journal.title, Country.of.publisher, Languages.in.which.the.journal.accepts.manuscripts, 
         Journal.license, Publisher, Review.process, Subjects, APC, 
         Persistent.article.identifiers, Keywords) %>%
  rename(
    title = Journal.title,
    country = Country.of.publisher,
    language = Languages.in.which.the.journal.accepts.manuscripts,
    license = Journal.license,
    Review = Review.process,
    Ids = Persistent.article.identifiers
  )

# Simplificar Subjects
journal.select$Subjects <- str_extract(journal.select$Subjects, "\\w+(?:[^\\w]+\\w+){0,1}")
journal.select$Subjects <- gsub("[[:punct:]]", "", journal.select$Subjects)
journal.select <- journal.select %>%
  mutate(Subjects = str_trim(Subjects)) %>%
  mutate(Subjects = sapply(Subjects, function(x) {
    words <- str_split(x, "\\s{2,}|,|\\s*\\band\\b\\s*|\\s+")[[1]]
    words <- unique(words[words != ""])
    paste(words, collapse = " ")
  }))

```

## üàØ Ordenar idiomas e identificadores

```{r}
sort_languages <- function(language_list) {
  sorted_languages <- sort(unlist(strsplit(language_list, ", ")))
  return(paste(sorted_languages, collapse = ", "))
}
journal.select$language <- sapply(journal.select$language, sort_languages)

sort_ids <- function(ids_list) {
  sorted_ids <- sort(unlist(strsplit(ids_list, ", ")))
  return(paste(sorted_ids, collapse = ", "))
}
journal.select$Ids <- sapply(journal.select$Ids, sort_ids)

```

### üìä An√°lisis por pa√≠s

```{r}
porcen_journal <- journal.select %>%
  group_by(country) %>%
  count() %>%
  ungroup() %>%
  mutate(percentage = n / sum(n) * 100) %>%
  bind_rows(data.frame(country = "Total", n = NA, percentage = sum(.$percentage)))

total.journal <- length(journal.select$title)
total.journal
```

## üåé Visualizaci√≥n: Am√©rica Latina

```{r}
selected_countries <- c("Brazil", "Argentina", "Mexico", "Colombia", "Ecuador", "Costa Rica", 
                        "Bolivia, Plurinational State of", "Dominican Republic", "El Salvador", 
                        "Guatemala", "Honduras", "Nicaragua", "Panama", "Chile", "Paraguay", 
                        "Peru", "Uruguay", "Venezuela, Bolivarian Republic of")

filtered_data <- porcen_journal %>% filter(country %in% selected_countries)

paises_total <- hchart(
  filtered_data,
  type = "pie",
  hcaes(x = country, y = percentage),
  dataLabels = list(enabled = TRUE),
  showInLegend = TRUE
) %>%
  hc_title(text = "<b>Porcentaje de pa√≠ses de Am√©rica Latina</b>") %>%
  hc_subtitle(text = "<i>Respecto al total de pa√≠ses en DOAJ</i>") %>%
  hc_exporting(enabled = TRUE, filename = "paises_total") %>%
  hc_plotOptions(pie = list(allowPointSelect = TRUE, cursor = "pointer")) %>%
  hc_legend(
    enabled = TRUE,
    layout = "horizontal",
    align = "center",
    verticalAlign = "bottom",
    y = 8,
    itemStyle = list(fontSize = "12px", fontWeight = "normal"),
    labelFormat = "{name}: {percentage:.1f}%"
  ) %>%
  hc_credits(
    enabled = TRUE,
    text = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.",
    href = "https://github.com/rominicky/analisis-doaj",
    itemStyle = list(fontSize = "8px", fontWeight = "normal"),
    position = list(align = "left", x = 10, y = -5)
  )

paises_total

htmlwidgets::saveWidget(paises_total, file = file.path(dir_output, "paises_total_interactivo.html"))
```

## Publicaciones en todo el mundo

```{r}
#en todo el mundo 
journal.select %>%
  group_by(language)%>%
  count()%>%
  filter(n >= 100 )%>%
  mutate(language = reorder(language, n)) %>%
  ggplot(aes(x = reorder(language, n), y = n, fill = language)) +
  geom_col () + # si agrego , fill = "blue" cambio color
  #scale_fill_manual(values = rainbow(length(unique(datos$language)))) +
  scale_fill_viridis_d(option = "C" ) +
  theme_minimal() +
  theme(legend.position = "n") +
  ylab("N√∫mero de veces que aparecen") +
  xlab(NULL) +
  ggtitle("Idiomas de publicaci√≥n de revistas en todo el mundo") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")

##ggsave(file.path(dir_output,"idiomas-total_min100-2024.jpg", width = 3000, height = 1500, units = "px", dpi = 300))
       
```

## Publicaciones por idioma por pa√≠ses 

```{r}
#idioma por pais
journal.select %>%
  group_by(country, language) %>%
  count() %>%
  ungroup() %>%
  filter(n >= 50 & n <= 750) %>%
  #mutate(language = reorder(language, n)) %>%  # idiomas por frecuencia
  ggplot(aes(x = reorder(language, n), y = n, fill = country)) +  # n como valor num√©rico
  geom_col() +
  coord_flip() +
  theme_minimal() + 
  theme(legend.position = "n"
    #plot.caption = element_text(hjust = 0, face = "italic", size = 9),
    #plot.margin = unit(c(1, 1, 2, 1), "cm")
  ) +
  ylab("N√∫mero de publicaciones") +
  #xlab(NULL) +
  ggtitle("Publicaciones por idioma y pa√≠s") +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output,"publ_paises-idiomas-total_min50-mx750-2024.jpg", width = 3000, height = 1500, units = "px", dpi = 300))
```

#### Otro

```{r}
journal.select %>%
  group_by(country, language) %>%
  count() %>%
  ungroup() %>%
  filter(n >= 50 & n <= 5500) %>%
  mutate(country = reorder_within(country, n, language)) %>%  # para que ordene dentro de cada panel
  ggplot(aes(x = country, y = n, fill = country)) +
  geom_col(show.legend = FALSE) +
  coord_flip() +
  facet_wrap(~ language, scales = "free_y") +  # un panel por idioma
  scale_x_reordered() +  # necesario con reorder_within
  theme_minimal() +
  theme(
    plot.caption = element_text(hjust = 0, face = "italic", size = 9),
    strip.text = element_text(size = 10, face = "bold")
  ) +
  xlab(NULL) +
  ylab("N√∫mero de publicaciones") +
  ggtitle("Publicaciones por pa√≠s en cada idioma") +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")

```

## An√°lisis por continente

```{r}
# por continente 
# Instalar la librer√≠a si no est√° instalada
install.packages("countrycode", repos = "https://cloud.r-project.org")

#VER tooltip_table
# Cargar las librer√≠as 
library(countrycode)
library(ggplot2)
library(dplyr)
library(viridis)
# 
journal.select <- journal.select %>%
  mutate(continent = countrycode(country, "country.name", "continent"))

# Por continente
journal.select %>%
  group_by(language, country, continent) %>%
  count() %>%
  filter(n >= 100 ) %>%
  mutate(language = reorder(language, n)) %>%
  ggplot(aes(x = language, y = n, fill = country)) +  
  geom_col(show.legend = FALSE) +  
  #geom_text(aes(label = n), vjust = -0.5, size = 3, color = "black") +
  theme_minimal() +
  ylab("N√∫mero de publicaciones") +
  xlab(NULL) +
  ggtitle("Idiomas de publicaci√≥n en todo el mundo diferenciado por pa√≠ses") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.") +
  facet_wrap(~ continent) +  # Usar facetas por continente
  scale_fill_viridis_d(option = "H") +  # Usar una paleta con m√°s colores
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
    axis.text.y = element_text(size = 10),
    axis.title.y = element_text(size = 12),
    plot.margin = margin(10, 10, 10, 10)
  )
#ggsave(file.path(dir_output, "idiomas-continente_min100.jpg", width = 3000, height = 1500, units = "px", dpi = 300))
```

# Con tooltip seg√∫n gpt

```{r}
#| eval: false

#https://github.com/jbkunst 
# Agregamos la columna de continentes
journal.select <- journal.select %>%
  mutate(continent = countrycode(country, "country.name", "continent"))

# Agrupamos los datos
datos_bubbles <- journal.select %>%
  group_by(country, continent, language) %>%
  summarise(n = n(), .groups = "drop") %>%
  filter(n >= 100)

# Creamos los tooltips como tablas HTML
datos_bubbles <- datos_bubbles %>%
  mutate(tooltip = tooltip_table(
    c("Pa√≠s", "Continente", "Idioma", "Publicaciones"),
    c(country, continent, language, n)
  ))

# Creamos el gr√°fico de burbujas agrupado por continente
highchart() %>%
  hc_chart(type = "packedbubble") %>%
  hc_title(text = "Publicaciones por pa√≠s agrupadas por continente") %>%
  hc_subtitle(text = "Tama√±o proporcional a la cantidad de publicaciones (n ‚â• 100)") %>%
  hc_tooltip(useHTML = TRUE, pointFormat = "{point.tooltip}") %>%
  hc_plotOptions(packedbubble = list(
    minSize = "20%",
    maxSize = "100%",
    zMin = 0,
    zMax = max(datos_bubbles$n),
    layoutAlgorithm = list(
      gravitationalConstant = 0.02,
      splitSeries = TRUE,
      seriesInteraction = TRUE,
      dragBetweenSeries = TRUE,
      parentNodeLimit = TRUE
    ),
    dataLabels = list(
      enabled = TRUE,
      format = "{point.name}",
      filter = list(property = "y", operator = ">", value = 200),
      style = list(color = "black", textOutline = "none", fontWeight = "normal")
    )
  )) %>%
  hc_add_series_list(
    datos_bubbles %>%
      group_by(continent) %>%
      group_split() %>%
      map(function(df) {
        list(
          name = unique(df$continent),
          data = purrr::map2(df$country, df$n, ~ list(
            name = .x,
            value = .y,
            tooltip = df$tooltip[df$country == .x][1]
          ))
        )
      })
  )
```




class(journal.select)

#similar con botones
# journal.select %>%
#   group_by(language, country, continent) %>%
#   count() %>%
#   filter(n >= 25 & n<= 150) %>%
#   mutate(language = reorder(language, n)) %>%
#   ggplot(aes(x = language, y = n, fill = country)) +  
#   geom_col(show.legend = FALSE) +  # Eliminamos la leyenda de los pa√≠ses
#   #geom_text(aes(label = n), vjust = -0.5, size = 3, color = "black") +  
#   theme_minimal() +
#   ylab("N√∫mero de publicaciones") +
#   xlab(NULL) +
#   ggtitle("Idiomas de publicaci√≥n de revistas en todo el mundo por pa√≠s") +
#   coord_flip() +
#   labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.") +
#   facet_wrap(~ continent, scales = "free_y") +  # Ajusta las escalas de cada faceta por continente
#   scale_fill_viridis_d(option = "H") +  # Paleta viridis con m√°s colores, ajustada para una mejor visualizaci√≥n
#   theme(
#     plot.title = element_text(hjust = 0.5, size = 16),
#     axis.text.x = element_text(size = 10, angle = 45, hjust = 1),  # Ajusta la rotaci√≥n para los textos en el eje X
#     axis.text.y = element_text(size = 10),
#     axis.title.y = element_text(size = 10),
#     plot.margin = margin(10, 10, 10, 10),
#     strip.text = element_text(size = 10),  # T√≠tulos de las facetas m√°s grandes
#     strip.background = element_rect(fill = "lightgray")  # Fondo gris claro para las facetas
#   )
##ggsave(file.path(dir_output, "idiomas-cont_min25_mx150.jpg", width = 3000, height = 1500, units = "px", dpi = 300)


##AMERICA LATINA

```{r}
journal.amlat <- journal.select[journal.select$country %in% selected_countries, ]

total.pais <- length(journal.amlat$title)
total.pais
#total <- c("Total de pa?ses", total.journal)
#pais <- c("Am√©rica Latina", total.pais)
#porc.pais <- data.frame(total, pais)
#pie(porc.pais, labels = porc.pais)

#journal.amlat ver de unificar idiomas que tengan distinto orden y juntar las ciencias sociales 


journal.amlat %>%
  filter(Subjects == "Social Sciences") %>%  # Cambi√© "=" a "==" para la comparaci√≥n
  group_by(language) %>%
  count() %>%
  filter(n >= 1) %>%
  mutate(language = reorder(language, n)) %>%
  ggplot(aes(x = reorder(language, n), y = n, fill = language)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = "n") +  # Cambi√© "n" a "none" para ocultar la leyenda
  scale_fill_viridis_d(option = "G") +
  ylab("N√∫mero de veces que aparecen") +
  xlab(NULL) +
  ggtitle("Idiomas de publicaciones sobre 'Social Sciences' en Am√©rica Latina") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "area_social_sciences_idioma_AmLatina.png", width = 3000, height = 1500, units = "px", dpi = 300))

```

## Por temas

```{r}
journal.amlat %>%
  filter(Subjects %in% c("History", "Education History", "Education Social", "History General", "History America", "Language", "Philosophy", "Political Science", "Education Theory", "Bibliography Library", "Auxiliary sciences", "Education Special", "Education", "Social Sciences")) %>%
  group_by(language) %>%
  count() %>%
  filter(n >= 3) %>%
  mutate(language = reorder(language, n)) %>%
  ggplot(aes(x = reorder(language, n), y = n, fill = language)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = "n") +  # Cambi√© "n" a "none" para ocultar la leyenda
  scale_fill_viridis_d(option = "G") +
  ylab("N√∫mero de veces que aparecen") +
  xlab(NULL) +
  ggtitle("Idiomas de publicaciones sobre Ciencias Sociales y Humanidades en Am√©rica Latina") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")  
#ggsave(file.path(dir_output, "area_cssoc_idioma_AmLatina.png", width = 3000, height = 1500, units = "px", dpi = 300))

```

## Unificaci√≥n de Ciencias SOciales y Humanidades 
  
```{r}
#############################################################
#Voy a unificar las social sciences en una 
# Crear un gr√°fico de barras apiladas
journal.amlat %>%
  group_by(language, country) %>%
  count() %>%
  filter(n >= 10) %>%
  mutate(language = reorder(language, n)) %>%
  ggplot(aes(x = language, y = n, fill = country)) +
  geom_col() +
  #geom_text(aes(label = n), hjust = -0.1, size = 3) +
  scale_fill_viridis_d(option = "D") +
  #scale_y_continuous(labels = comma) +
  theme_minimal() +
  theme(
    legend.position = "right",
    plot.title = element_text(face = "bold", size = 14),
    axis.text.y = element_text(size = 10)
  ) +
  ylab("N√∫mero de publicaciones") +
  xlab("Idioma") +
  ggtitle(
    "Distribuci√≥n de idiomas en publicaciones acad√©micas de Am√©rica Latina",
    subtitle = "Solo se muestran combinaciones con al menos 10 registros"
  ) +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "idiomas-amlat_min10.jpg", width = 3000, height = 1500, units = "px", dpi = 300))

```

## Publicaciones en Ingles

```{r}
#| eval: false


english <- journal.amlat[journal.amlat$language == "English", ]
colnames(english)

install.packages("scico")

library(scico)
install.packages("Cairo")
library(Cairo)

# Crear el gr√°fico de dispersi√≥n con etiquetas de conteo
ggplot(journal.amlat %>% 
         group_by(language, country, Subjects) %>% 
         summarise(count = n()) %>% 
         filter(count >= 4 ) %>% 
         mutate(language = reorder(language, count)), 
       aes(x = country, y = language, color = Subjects)) +
  geom_point(size = 5, alpha = 0.7) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 1 , size = 16),  # Espacio bajo el t√≠tulo
    axis.text.x = element_text(angle = 60, hjust = 1),
    legend.position = "right",
    legend.box = "horizontal",
    legend.title = element_text(size = 7),
    legend.text = element_text(size = 7),
    legend.spacing.y = unit(0.1, "cm"),  # Espacio entre filas de leyenda
    plot.margin = margin(t = 20, r = 20, b = 20, l = 80)
  ) +
  guides(color = guide_legend(ncol = 2, byrow = TRUE)) +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.") +
  ylab("Idiomas") +
  xlab("Pa√≠ses") +
  ggtitle("Relaciones entre:
          pa√≠ses, idiomas y √°reas en publicaciones de Am√©rica Latina") +
  #scale_color_scico_d(palette = "berlin")  # Tambi√©n prob√°: "lajolla", "tokyo", "batlow"
  scale_color_viridis_d(option = "D")  # Utilizar una paleta de colores como Viridis
#ggsave(file.path(dir_output, "relacion_idiomas_temas-amlat.jpg",
       width = 3800, height = 1900, units = "px", dpi = 300))
library(viridis)


# ggplot(english, aes(x = country, fill = Subjects)) +
#   geom_bar(position = "stack") +
#   scale_fill_viridis_d(option = "D") +  # Usar la paleta viridis
#   theme_minimal() +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
#   ylab("N√∫mero de registros") +
#   xlab("Pa√≠ses") +
#   ggtitle("Distribuci√≥n de temas por pa√≠ses de Am√©rica Latina con publicaciones unicamente en Ingl√©s")

```

## Mejorado con highcharter

```{r}
#| eval: false
 
library(highcharter)
library(dplyr)
library(countrycode)

# Preparar los datos
datos_disp <- journal.amlat %>% 
  group_by(language, country, Subjects) %>%
  summarise(count = n(), .groups = "drop") %>%
  filter(count >= 4)

# Tooltip personalizado
datos_disp <- datos_disp %>%
  mutate(tooltip = tooltip_table(
    c("Pa√≠s", "Idioma", "√Årea tem√°tica", "Cantidad"),
    c(country, language, Subjects, count)
  ))

# Crear el gr√°fico interactivo
highchart() %>%
  hc_chart(type = "scatter") %>%
  hc_title(text = "Relaciones entre pa√≠ses, idiomas y √°reas en publicaciones de Am√©rica Latina") %>%
  hc_subtitle(text = "Tama√±o fijo (n ‚â• 4), color seg√∫n √°rea tem√°tica") %>%
  hc_xAxis(categories = unique(datos_disp$country), title = list(text = "Pa√≠ses"), labels = list(rotation = 45)) %>%
  hc_yAxis(categories = unique(datos_disp$language), title = list(text = "Idiomas")) %>%
  hc_tooltip(useHTML = TRUE, pointFormat = "{point.tooltip}") %>%
  hc_plotOptions(scatter = list(
    marker = list(radius = 7, symbol = "circle", fillOpacity = 0.7),
    tooltip = list(pointFormat = "{point.tooltip}")
  )) %>%
  hc_add_series(data = datos_disp, type = "scatter",
                hcaes(x = country, y = language, group = Subjects),
                tooltip = datos_disp$tooltip,
                name = "√Årea tem√°tica") %>%
  hc_legend(enabled = TRUE, layout = "vertical", align = "right", verticalAlign = "middle") %>%
  hc_colors(viridisLite::viridis(length(unique(datos_disp$Subjects)), option = "D"))

```


## otros graficos a mejorar

```{r}
#| eval: false
#| include: false
library(scico)
#otro gr√°fico
journal.amlat %>%
  group_by(Publisher)%>%
  count()%>%
  filter(n>15)%>%
  mutate(Publisher = reorder(Publisher, n)) %>%
  ggplot(aes(x = reorder(Publisher, n), y = n, fill = Publisher)) +  # Ordenar x seg√∫n la frecuencia -n
  geom_col () + # si agrego , fill = "blue" cambio color
  theme_minimal() +
  theme(legend.position = "n") +
  scale_color_scico_d(palette = "bilbao") +
  ylab("Cantidad de revistas publicadas por") +
  xlab(NULL) +
  ggtitle("Editorial de publicaci√≥n de revistas en Am√©rica Latina",
    subtitle = "Restringido a editoriales con m√°s de 15 revistas") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "editorial_Am√©rica Latina_min15.jpg", width = 3000, height = 1500, units = "px", dpi = 300))

journal.amlat %>%
  group_by(license) %>%
  count() %>%
  filter(n >= 10) %>%
  mutate(license = reorder(license, n)) %>%
  ggplot(aes(x = reorder(license, n), y = n, fill = license)) +
  geom_col() +
  scale_fill_scico_d(palette = "lapaz") +
  theme_minimal() +
  theme(legend.position = "n") +  # debe ser "none", no "n"
  ylab("Frecuencias") +
  xlab("Tipo de licencias") +
  ggtitle("Licencias utilizadas por revistas en Am√©rica Latina") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "licencia_AmLatina_min5.png", width = 3000, height = 1500, units = "px", dpi = 300))

journal.amlat %>%
  group_by(Review)%>%
  count()%>%
  filter(n>=5)%>%
  mutate(Review = fct_reorder(Review, n)) %>%
  ggplot(aes(x = reorder(Review, n), y = n, fill = Review)) +
  geom_col () + # si agrego , fill = "blue" cambio color
  scale_fill_scico_d(palette = "berlin") +
  theme_minimal() +
  theme(legend.position = "n") +
  ylab("Frecuencia") +
  xlab("Tipo de revisiones") +
  ggtitle("Proceso de revisi√≥n para publicaciones para las revistas de Am√©rica Latina") +
  scale_color_scico_d(palette = "lajolla") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "revision_AmLatina_min10.png", width = 3000, height = 1500, units = "px", dpi = 300))

journal.amlat %>%
  group_by(Subjects) %>%
  count() %>%
  filter(n > 10) %>%
  mutate(Subjects = fct_reorder(Subjects, n)) %>%
  ggplot(aes(x = reorder(Subjects, n), y = n, fill = Subjects)) +
  geom_col() +
  theme_minimal() +
  theme(legend.position = "n") +
  ylab("Frecuencia") +
  xlab("√Åreas") +
  ggtitle("√Åreas de publicaci√≥n de revistas en Am√©rica Latina",
          subtitle = "Frecuencia mayor a 10") +
  scale_fill_scico_d(palette = "lapaz") +
  coord_flip() +
  labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
#ggsave(file.path(dir_output, "areas_amLatina_min10.jpg", width = 3000, height = 1500, units = "px", dpi = 300))
       
```




analizar_pais <- function(pais, data = journal.amlat) {
  library(dplyr)
  library(ggplot2)
  
  # Filtrar datos por pa√≠s
  journal.pais <- data %>% filter(country == pais)
  
  # Mostrar total de revistas
  total.pais <- length(journal.pais$title)
  print(paste("Total de revistas en", pais, ":", total.pais))
  # Helper para guardar
  guardar_grafico <- function(plot, nombre, pais) {
    ruta <- file.path(path_wd, paste0(nombre, "_", pais, ".jpg"))
    #ggsave(file.path(dir_output, ruta, plot = plot, width = 3000, height = 1500, units = "px", dpi = 300)
  }
  
  # Gr√°fico por idioma
  g1 <- journal.pais %>%
    group_by(language) %>%
    count() %>%
    filter(n > 5) %>%
    mutate(language = reorder(language, n)) %>%
    ggplot(aes(x = reorder(language, n), y = n, fill = language)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "n") +
    ylab("N√∫mero de veces que aparecen") +
    xlab(NULL) +
    ggtitle(paste("Idiomas de publicaci√≥n de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.") 
  print(g1)
  guardar_grafico(g1, "idiomas_", pais)
  
  # Gr√°fico por editorial
  g2 <- journal.pais %>%
    group_by(Publisher) %>%
    count() %>%
    filter(n > 5) %>%
    mutate(Publisher = reorder(Publisher, n)) %>%
    ggplot(aes(x = reorder(Publisher, n), y = n, fill = Publisher)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "none") +
    ylab("Cantidad de revistas publicadas por") +
    xlab(NULL) +
    ggtitle(paste("Editorial de publicaci√≥n de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
  print(g2)
  guardar_grafico(g2, "editorial_", pais)
  
  # Gr√°fico por licencias
  g3 <- journal.pais %>%
    group_by(license) %>%
    count() %>%
    filter(n > 1) %>%
    mutate(license = reorder(license, n)) %>%
    ggplot(aes(x = reorder(license, n), y = n, fill = license)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "none") +
    ylab("Tipo de licencias") +
    xlab(NULL) +
    ggtitle(paste("Licencias de publicaci√≥n de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
  print(g3)
  guardar_grafico(g3, "licencias_", pais)
  
  # Gr√°fico por proceso de revisi√≥n
  g4 <- journal.pais %>%
    group_by(Review) %>%
    count() %>%
    filter(n > 5) %>%
    mutate(Review = reorder(Review, n)) %>%
    ggplot(aes(x = reorder(Review, n), y = n, fill = Review)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "none") +
    ylab("Proceso de revisi√≥n") +
    xlab(NULL) +
    ggtitle(paste("Proceso de revisi√≥n de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
  print(g4)
  guardar_grafico(g4, "revision_", pais)
  
  # Gr√°fico por temas
  g5 <- journal.pais %>%
    group_by(Subjects) %>%
    count() %>%
    filter(n > 5) %>%
    mutate(Subjects = reorder(Subjects, n)) %>%
    ggplot(aes(x = reorder(Subjects, n), y = n, fill = Subjects)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "none") +
    ylab("Temas") +
    xlab(NULL) +
    ggtitle(paste("Temas de publicaci√≥n de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
  print(g5)
  guardar_grafico(g5, "temas_", pais)
  
  # Gr√°fico por temas
  g6 <- journal.pais %>%
    group_by(id) %>%
    count() %>%
    filter(n > 5) %>%
    mutate(id = reorder(id, n)) %>%
    ggplot(aes(x = id, y = n, fill = id)) +
    geom_col() +
    theme_minimal() +
    theme(legend.position = "none") +
    ylab("Identificadores persistentes") +
    xlab(NULL) +
    ggtitle(paste("Identificadores persistentes de revistas en", pais)) +
    coord_flip() +
    labs(caption = "Citar como: Romina De Le√≥n, 2025. An√°lisis de revistas latinoamericanas en DOAJ.")
  print(g5)
  guardar_grafico(g6, "identificadores_", pais)
}

walk(selected_countries, analizar_pais)
 
selected_countries
analizar_pais("Argentina")
analizar_pais("Brazil")
analizar_pais("Chile")
analizar_pais("Colombia")
analizar_pais("Mexico")
analizar_pais("Ecuador")
analizar_pais("Costa Rica")
analizar_pais("Bolivia, Plurinational State of")
analizar_pais("Dominican Republic")
analizar_pais("El Salvador")
analizar_pais("Guatemala")
analizar_pais("Honduras")
analizar_pais("Nicaragua")
analizar_pais("Panama") 
analizar_pais("Paraguay")
analizar_pais("Peru")
analizar_pais("Uruguay")
analizar_pais("Venezuela, Bolivarian Republic of")



##################################################################

